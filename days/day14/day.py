import re
from collections import defaultdict
from operator import mul
from functools import reduce

def main(day_input):  
    W=101 # 0,49 50 51,100
    H=103 # 0,50 51 52,102
    S = 100
    def get_quad(x, y):
        if x == 50 or y == 51: return -1
        if x < 50:
            if y < 51: return 0
            else: return 2
        else:
            if y < 51: return 1
            else: return 3

    quads = defaultdict(int)
    robots = []
    velocities = []
    for row in day_input:
        px, py = map(int, re.search(r'p=(\d+),(\d+)', row).groups())
        vx, vy = map(int, re.search(r'v=(-?\d+),(-?\d+)', row).groups())
        robots.append((px, py))
        velocities.append((vx, vy))
        
        fxa = px + vx * S
        fx = fxa % W
        
        fya = py + vy * S
        fy = fya % H

        quads[get_quad(fx, fy)] += 1


    tree = [(50, 0)]
    for x in range(49, 30, -1):
        for y in range(1, 20):
            tree.append((x, y))
    
    for x in range(51, 60):
        for y in range(1, 20):
            tree.append((x, y))

    
    def pprint():
        for y in range(H):
            for x in range(W):
                if (x, y) in robots:
                    print('X', end='')
                else:
                    print('.', end='')
            print('')
        print()
        
    easter_egg_sec = 1
    while True:
        robots = [((px+vx) % W, (py+vy) % H) for (px, py), (vx, vy) in zip(robots, velocities)]
        if len(set(robots)) == len(robots): break
        easter_egg_sec += 1


    return reduce(mul, map(lambda x: quads[x], range(4))), easter_egg_sec


#...............................................................X.....................................
#................................................................................................X....
#.....................X.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...............................................
#.......................X.............................X.....................................X.........
#.......................X.............................X.....................X...........X.............
#.......................X.............................X...............................................
#.......................X.............................X...............................................
#X......................X..............X..............X...............................................
#.......................X.............XXX.............X............X..................................
#.......................X............XXXXX............X...............................................
#.......................X...........XXXXXXX...........X..X.........................................X..
#............X..........X..........XXXXXXXXX..........X..................................X............
#.......................X............XXXXX............X...........X................X...X..............
#.....X.................X...........XXXXXXX...........X...............................................
#....X..................X..........XXXXXXXXX..........X...............................................
#...............X.......X.........XXXXXXXXXXX.........X..................X............................
#.......................X........XXXXXXXXXXXXX........X...........................X.............X.....
#..............X........X..........XXXXXXXXX..........X.....X............X............................
#.......................X.........XXXXXXXXXXX.........X..............................X................
#.......................X........XXXXXXXXXXXXX........X...............................................
#....X.......X..........X.......XXXXXXXXXXXXXXX.......X...............................................
#.......................X......XXXXXXXXXXXXXXXXX......X.......X.......................................
#......X................X........XXXXXXXXXXXXX........X...............................................
#.......................X.......XXXXXXXXXXXXXXX.......X.....X.........................................
#.......................X......XXXXXXXXXXXXXXXXX......X....................................X..........
#.......................X.....XXXXXXXXXXXXXXXXXXX.....X.........................................X.....
#.......................X....XXXXXXXXXXXXXXXXXXXXX....X........................X...............X......
#.......................X.............XXX.............X...............................................
#.......................X.............XXX.............X...............................................
#.......................X.............XXX.............X..........................X.......X............
#.......................X.............................X.....................X......X..................
#.......................X.............................X...............................................
#..............X...X....X.............................X...............................................
#.......................X.............................X......X....................X...................
#.......................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX...............................................
#.....................................................................................................
#............................................................................................X........